var starsContainer = document.querySelector('.stars-container');    // Get the container of the Rating input
var boxReviewContent = document.querySelector('.review_content');   // Get the container of the Content input

// If there are any errors in the submited form, then...
<% if @review.errors.any? %>
  // If there are no errors in the Rating input, then remove any error message if it exists
  <% if @review.errors.messages[:rating].empty? %>
    if (starsContainer.childElementCount > 1) {
      document.querySelector('.stars-container .invalid-feedback').remove();
    }

  // Otherwise insert the error message (making sure only one error message is displayed)
  <% else %>
    if (starsContainer.childElementCount < 2) {
      var ratingNode = document.createElement('div');
      ratingNode.classList = 'invalid-feedback';
      ratingNode.style.display = 'block';
      ratingNode.style.margin = '0';
      ratingNode.innerHTML = "Rating <%= @review.errors.messages[:rating].first %>";

      document.querySelector('.stars-container').appendChild(ratingNode);
    }
  <% end %>

  // If there are no errors in the Content input, then remove any error message if it exists
  <% if @review.errors.messages[:content].empty? %>
    if (boxReviewContent.childElementCount > 1) {
      boxReviewContent.classList.remove('form-group-invalid');
      document.querySelector('.review_content textarea').classList.remove('is-invalid');
      document.querySelector('.review_content .invalid-feedback').remove();
    }

  // Otherwise insert the error message (making sure only one error message is displayed)
  <% else %>
    if (boxReviewContent.childElementCount < 2) {
      var contentNode = document.createElement('div');
      contentNode.classList = 'invalid-feedback';
      contentNode.innerHTML = "Content <%= @review.errors.messages[:content].first %>";

      boxReviewContent.classList.add('form-group-invalid');
      document.querySelector('.review_content textarea').classList.add('is-invalid');
      boxReviewContent.appendChild(contentNode);
    }
  <% end %>

// Otherwise, if there are no errors in the submited form...
<% else %>
  // Refresh the page content
  document.getElementById("reviews-list").innerHTML = "<%= j render partial: "reviews-list" %>";

  document.querySelector('#ModalNewReview button').click();     // Close Modal
  document.getElementById('review_content').value = '';         // Empty the content field

  var radioBox = document.querySelectorAll('.stars input');     // Get the list of Rating radio boxes

  // Clear the Rating radio boxes
  for (let i = 1; i < 6; i++) {
    radioBox[i].checked = false;
  }

  // If there are no errors displayed on the form, remove them
  if (starsContainer.childElementCount > 1) {
    document.querySelector('.stars-container .invalid-feedback').remove();
  }

  if (boxReviewContent.childElementCount > 1) {
    boxReviewContent.classList.remove('form-group-invalid');
    document.querySelector('.review_content textarea').classList.remove('is-invalid');
    document.querySelector('.review_content .invalid-feedback').remove();
  }
<% end %>
